#!/bin/bash
# Generated by `rkc backups generate backup`
# Docs: https://github.com/riotkit-org/rkc

set -eu

COMMAND="pgbr db restore --password '{{ .Params.password }}' --user '{{ .Params.user }}' --db-name '{{ .Params.db }}' --port '{{ .Params.port }}'";
selectedVersion="${RESTORE_VERSION:-latest}"

export BM_AUTH_TOKEN="{{ .Repository.token }}";
export BM_COLLECTION_ID="{{ .Repository.collectionId }}";
export BM_PASSPHRASE="{{ .Repository.passphrase }}";

echo " >> Executing backup command and uploading piped result"

exec backup-maker restore --url "{{ .Repository.url }}" \
    -c "${COMMAND}" \
    --key {{ .Repository.encryptionKeyPath }} \
    --recipient {{ .Repository.recipient }}\
    --log-level info \
    --version=${selectedVersion}
